#!/bin/bash

port=9123
if netstat -ltun | grep $port &>/dev/null; then echo "port $port is not available (remedy: free this port or change port numner in the test)" >&2; exit 1; fi
timeout=1

echo "tcp_message" | socat -u - tcp-listen:$port,reuseaddr &
output=$( timeout -k 1 -s TERM $timeout io-client tcp:localhost:$port )
echo "tcp/output=\"$output\""

{ sleep 0.1 && echo "udp_message" | socat - udp-sendto:localhost:$port; } &
output=$( timeout -k 1 -s TERM $timeout io-client udp:$port )
echo "udp/output=\"$output\""

