#!/bin/bash

function types_incorrect_name { python -c "import comma; point_t = comma.csv.struct( 'x', 'invalid' )"; }
function types_empty_name { python -c "import comma; point_t = comma.csv.struct( 'x', '' )"; }
function types_incorrect_number { python -c "import comma; point_t = comma.csv.struct( 'x,y', 'float64' )"; }

function basic
{
    python -c "$( cat <<END
import numpy
import comma

data_t = comma.csv.struct( 'x,id', numpy.float64, numpy.uint32 )
data_t = comma.csv.struct( 'x,id', 'float64', 'uint32' )
data_t = comma.csv.struct( 'x,id', 'f8', 'u4' )
data_t = comma.csv.struct( 't', 'datetime64[us]' )
data_t = comma.csv.struct( 'name', 'S10' )
END
)"
}

function record
{
    local what=$1
    python -c "$( cat <<END
import comma

point_t = comma.csv.struct( 'x,y,z', 'float64', 'float64', 'float64' )
timestamped_point_t = comma.csv.struct( 't,coordinates', 'datetime64[us]', point_t )
record_t = comma.csv.struct( 'observer,event', 'S3', timestamped_point_t )
print ','.join( record_t.$what )
END
)"
}

types_incorrect_name; echo "types_incorrect_name/status=$?"
types_empty_name; echo "types_empty_name/status=$?"
types_incorrect_number; echo "types_incorrect_number/status=$?"

basic; echo "basic/status=$?"

for what in fields types; do
    output=$( record $what )
    status=$?
    echo "record/$what/output=$output"
    echo "record/$what/status=$status"
done
